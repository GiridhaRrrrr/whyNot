<% layout('/layouts/boilerplate') %>
<head>
    <link rel="stylesheet" href="/css/userCard.css">
</head>
<div class="usercard-container">
    <div class="profile-card">
        <img src=<%= user.img %> alt="Profile" class="profile-img">
        <h2 class="profile-name"><%= user.username %></h2>
        <p class="profile-stats">
            Following: <span><%= user.following ? user.following.length : 0 %></span> &nbsp; | &nbsp; Followers: <span><%= user.followers ? user.followers.length : 0 %></span> &nbsp; | &nbsp; Total Posts: <span><%= userPosts.length %></span>
        </p>
        <button class="follow-btn">Follow</button>
        <!-- <p class="posts-title">My Posts:</p> -->
    </div>
    <h1 class="posts-title">MY POSTS :</h1>
    <div class="allPosts">
        <% if(userPosts) {%>
            <% for(let post of userPosts) { %>
                <a href="/posts/<%= post._id %>" class="card-link">
                    <div class="card-container">
                        <div class="card">
                            <div class="card-header">
                                <img src="https://plus.unsplash.com/premium_vector-1730127163758-5e2a1b4ad2a0?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTN8fGFuaW1hdGVkJTIwcHJvZmlsZSUyMHBpY3xlbnwwfHwwfHx8MA%3D%3D" alt="User Picture">
                                <span>Username</span>
                                <span class="post-date">
                                    <%= new Date(Number(post.createdAt)).toLocaleString("en-IN", { 
                                        timeZone: "Asia/Kolkata", 
                                        day: "2-digit", 
                                        month: "short", 
                                        year: "numeric", 
                                        hour: "2-digit", 
                                        minute: "2-digit" 
                                    }) %>
                                </span>
                            </div>
                            <div class="card-body">
                                <div class="card-content">
                                    <h2><%= post.question  %></h2>
                                    <% if (post.description.split(' ').length > 25) { %>
                                        <p><%= post.description.split(' ').slice(0, 25).join(' ') %>... <span style="color: #007bff;">more</span></p>
                                    <% } else { %>
                                        <p><%= post.description %></p>
                                    <% } %>
                                    <div class="tags">
                                        <% if (post.tags && post.tags.length > 0) { %>
                                            <% for (let tag of post.tags) { %>
                                              <span class="tag"><%= tag %></span>
                                            <% } %>
                                          <% } %>
                                                             
                                    </div>
                                    <div class="buttons">
                                        <a href="/posts/<%= post._id %>/edit"><button class="btn-1"><i class="fa-regular fa-pen-to-square"></i> Edit</button></a>
                                        <form method="Post" action="/posts/<%= post._id %>?_method=DELETE" style="display: inline;"></form>
                                            <button class="btn-2"><i class="fa-solid fa-trash-can"></i> Delete</button>
                                        </form>
                                    </div>
                                    <!-- <div class="pending">PENDING</div> -->
                                </div>
                                <% if (post.img) { %>
                                    <div class="card-image">
                                        <img src="<%= post.img %>" alt="Project Image">
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </a>
            <% } %>   
        <% } else{ %>
            <div class="alert alert-success alert-dismissible fade show col-10 offset-1" role="alert">
                <p>No Posts Yet!</p>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <% } %>
    </div>


</div>